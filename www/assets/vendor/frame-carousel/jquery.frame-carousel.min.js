/*! Frame Carousel - v0.1.0 - 2015-09-18
* http://www.eastros.com/frame-carousel/
* Copyright (c) 2015 Umar Ashfaq; Licensed MIT */
!function(a){function b(b,c){a.extend(this,{el:b,$el:a(b).data("frameCarousel",this),$:a.proxy(a.fn.find,a(b)),options:c||{},attributes:{},elements:{}}),h.call(this).then(a.proxy(function(){s.call(this),this["goto"](this.options.first,{animate:!1})},this))}var c="<div class='fc-controls'><a href='#' rel='go-left' class='fc-btn fc-btn-left'></a><a href='#' rel='go-right' class='fc-btn fc-btn-right'></a></div><div class='fc-pagination'><div class='fc-pagination-inner'></div></div><div class='fc-image-mask'><div class='fc-film'></div></div>",d={touchstart:"touchstart mousedown",touchmove:"touchmove mousemove",touchend:"touchend mouseup",touchcancel:"touchcancel",touchleave:"touchleave mouseout",transitionend:"transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd"},e=function(b){var c=a("<img />"),d=a.Deferred();return c.hide(),c.bind("load",function(){d.resolve(a(this))}),a("body").append(c),c.attr("src",b),a("#tempImg").remove(),d},f=function(a){var b,c=a.originalEvent||a;return b=c.touches&&c.touches.length?{x:c.touches[0].pageX,y:c.touches[0].pageY}:c.changedTouches&&c.changedTouches.length?{x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY}:void 0!==c.pageX?{x:c.pageX,y:c.pageY}:{x:c.clientX,y:c.clientY}},g=function(){var b,c=a(window).width(),d=function(a){var b=!1;return b=a.minScreenWidth&&a.maxScreenWidth?c>=a.minScreenWidth&&c<=a.maxScreenWidth:a.maxScreenWidth?c<=a.maxScreenWidth:a.minScreenWidth?c>=a.minScreenWidth:!0};return this.options.frameSize.every(function(a){return d(a)?(b=a,!1):!0},this),b},h=function(){var b=a('script[src*="frame-carousel"]').attr("src").replace("jquery.frame-carousel.js","").replace("jquery.frame-carousel.min.js","")+"sample/";return this.options=a.extend({first:0,debug:!1,swipeThreshold:10,frame:b+"frame.png",frameSize:[{width:600,minScreenWidth:1200},{width:500,maxScreenWidth:1199,minScreenWidth:768},{width:300,maxScreenWidth:767}],boundingBox:{left:"4.3%",top:"4.48%",width:"91.4%",height:"61.1%"},collapseThreshold:450,images:function(){return[1,2,3,4,5,6,7,8,9,10].map(function(a){return b+a+".jpg"})}(),controlsPosition:{top:"35%"}},this.options),e(this.options.frame).then(a.proxy(function(b){var c={width:b.width(),height:b.height()},d=c.width/c.height;this.options.frameSize=this.options.frameSize.map(function(a){return a.width&&a.height||(!a.width&&a.height?a.width=a.height*d:a.width&&!a.height?a.height=a.width/d:a.width||a.height||(a.width=c.width,a.height=c.height)),a}),this.options.frameSize.push(c),this.attributes=a.extend(this.attributes,{originalFrameSize:c,current:0,id:(new Date).getTime(),originalStyleValue:this.$el.attr("style")||"",originalClassValue:this.$el.attr("class")||""})},this))},i=function(){return this.previous(),!1},j=function(){return this.next(),!1},k=function(b){var c=f(b),d=this.elements.$mask.width(),e=this.elements.$images.length,g=100/e,h=g*this.attributes.current;return a.extend(this.attributes,{swipeStartPosition:c,screenWidth:d,screenCount:e,screenWidthAsPercentageOfFilm:g,screenOffset:h,thresholdAsPercentageOfFilm:this.options.swipeThreshold/100*g,hasTouchStarted:!0}),!1},l=function(a){if(!this.attributes.hasTouchStarted)return!1;var b=f(a);return this.attributes.swipeDisplacement={x:(this.attributes.swipeStartPosition.x-b.x)/this.attributes.screenWidth*this.attributes.screenWidthAsPercentageOfFilm,y:this.attributes.swipeStartPosition.y-b.y},this.attributes.swipeCompoundDisplacement={x:this.attributes.swipeDisplacement.x+this.attributes.screenOffset,y:this.attributes.swipeDisplacement.y},this.attributes.swipeCompoundDisplacement.x<0&&(this.attributes.swipeCompoundDisplacement.x=0),this.attributes.swipeCompoundDisplacement.x+this.attributes.screenWidthAsPercentageOfFilm>100&&(this.attributes.swipeCompoundDisplacement.x=this.attributes.screenWidthAsPercentageOfFilm*(this.attributes.screenCount-1)),this["goto"](this.attributes.current,{animate:!1,updateStates:!1,distance:this.attributes.swipeCompoundDisplacement.x}),!1},m=function(){if(!this.attributes.hasTouchStarted)return!1;delete this.attributes.hasTouchStarted;var a=Math.abs(Math.ceil(this.attributes.swipeDisplacement.x/this.attributes.screenWidthAsPercentageOfFilm));return Math.abs(this.attributes.swipeDisplacement.x)>this.attributes.thresholdAsPercentageOfFilm?this.attributes.swipeDisplacement.x<0?this["goto"](this.attributes.current-a-1):this["goto"](this.attributes.current+a):this["goto"](this.attributes.current),!1},n=function(){delete this.attributes.hasTouchStarted,this["goto"](this.attributes.current)},o=function(){this.attributes.is_animating=!1,this.elements.$film.css("transition","all 0s")},p=function(){clearTimeout(this.attributes.resizeTimeout),this.attributes.resizeTimeout=setTimeout(a.proxy(q,this),500)},q=function(){this.$el.css(g.call(this))[a(window).width()>this.options.collapseThreshold?"removeClass":"addClass"]("fc-collapsed")},r=function(){this.elements.$btn_go_left.fcRemoveClass("disabled"),this.elements.$btn_go_right.fcRemoveClass("disabled"),0===this.attributes.current?this.elements.$btn_go_left.fcAddClass("disabled"):this.attributes.current===this.elements.$images.length-1&&this.elements.$btn_go_right.fcAddClass("disabled")},s=function(){a(window).resize(a.proxy(p,this)),this.$el.fcAddClass("fc").fcAddClass("fc-"+this.attributes.id).css({"background-image":"url('"+this.options.frame+"')"}).append(c),this.options.debug&&this.$el.fcAddClass("fc-debug"),this.$el.css(g.call(this))[a(window).width()>this.options.collapseThreshold?"removeClass":"addClass"]("fc-collapsed"),this.elements=a.extend(this.elements,{$controls:this.$(".fc-controls"),$pgn_inner:this.$(".fc-pagination-inner"),$mask:this.$(".fc-image-mask"),$film:this.$(".fc-film"),$btn_go_left:this.$("a[rel=go-left]"),$btn_go_right:this.$el.find("a[rel=go-right]")}),this.options.controlsPosition&&this.elements.$controls.css(this.options.controlsPosition),this.elements.$mask.css(this.options.boundingBox);var b=this.attributes.touchEventTarget=".fc-"+this.attributes.id+" .fc-image-mask";a("body").on(d.touchstart,b,a.proxy(k,this)).on(d.touchmove,b,a.proxy(l,this)).on(d.touchend,b,a.proxy(m,this)).on(d.touchcancel,b,a.proxy(n,this)).on(d.touchleave,b,a.proxy(m,this)),this.elements.$film.css({width:100*this.options.images.length+"%"}).on(d.transitionend,a.proxy(o,this)),a.each(this.options.images,a.proxy(function(b,c){var d=a("<a/>").attr({href:"#"}).html("&nbsp;").click(a.proxy(function(){return this["goto"](b),!1},this)).appendTo(this.elements.$pgn_inner);a("<div/>").fcAddClass("fc-image-masked").fcAddClass("fc-animate").css(a.extend({"background-image":"url('"+c+"')"},this.options.boundingBox,{width:100/this.options.images.length+"%",height:"100%",left:100*b+"%"})).appendTo(this.elements.$film).on("change:class",a.proxy(function(a){"active"===a.className&&d[a.changeType]("active")},this))},this)),this.elements.$images=this.$(".fc-image-masked"),this.elements.$btn_go_left.click(a.proxy(i,this)),this.elements.$btn_go_right.click(a.proxy(j,this))};a.extend(b.prototype,{debug:function(a){this.options.debug&&this.$el.attr("data-debug",a)},count:function(){var a=this.$el.find(".fc-image-masked");return a.length},"goto":function(b,c){if(c=c||{},c=a.extend({animate:!0,updateStates:!0,distance:b*(100/this.elements.$images.length)},c),!(this.attributes.is_animating||0>b||b>this.elements.$images.length-1)){c.animate&&(this.attributes.is_animating=!0);var d=c.distance,e=0-d+"%",f={transform:"translate3d("+e+", 0, 0)"};c.animate&&(f.transition="all .4s ease-out"),this.elements.$film.css(f),c.animate&&setTimeout(a.proxy(function(){this.attributes.is_animating&&(this.attributes.is_animating=!1)},this),1e3),c.updateStates&&(this.attributes.current=b,this.elements.$images.fcRemoveClass("active"),this.elements.$images.eq(b).fcAddClass("active"),r.call(this))}},next:function(a){this["goto"](this.attributes.current+1,a)},previous:function(a){this["goto"](this.attributes.current-1,a)},resize:function(){},removeFrame:function(){},destroy:function(){var b=this.attributes.touchEventTarget;a("body").off(d.touchstart,b,k).off(d.touchmove,b,l).off(d.touchend,b,m).off(d.touchcancel,b,n).off(d.touchleave,b,m),a(window).off("resize",p),this.$el.empty().attr({"class":this.attributes.originalClassValue,style:this.attributes.originalStyleValue})}}),a.extend(a.fn,{frameCarousel:function(a){return this.each(function(){return new b(this,a)})},fcAddClass:function(b){var c=a.fn.addClass.apply(this,arguments);return a(this).trigger(a.Event("change:class",{target:this,changeType:"addClass",className:b})),c},fcRemoveClass:function(b){var c=a.fn.removeClass.apply(this,arguments);return a(this).trigger(a.Event("change:class",{target:this,changeType:"removeClass",className:b})),c}})}(jQuery);